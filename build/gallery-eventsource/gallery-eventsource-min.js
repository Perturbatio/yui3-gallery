YUI.add("gallery-eventsource",function(E){var A=typeof EventSource!="undefined",C;function B(F){E.Event.Target.call(this);this.url=F;this.readyState=0;this._transport=null;this._init();}var D;if(A){D={_init:function(){var G=new EventSource(this.url),F=this;G.onopen=G.onmessage=G.onerror=E.bind(function(H){switch(H.type){case"open":this.fire("open");this.readyState=1;break;case"message":this.fire({type:"message",data:H.data});break;case"error":this.fire("error");this.readyState=2;break;}},this);this._transport=G;},close:function(){this._transport.close();this.readyState=2;},attach:function(J,I,H,G,F){var K=this;if(J!="message"){this._transport.addEventListener(J,function(L){K.fire({type:L.type,data:L.data});},false);}E.Event.Target.attach.call(this,arguments);}};}else{D={_init:function(){var G,F=this;this._lastIndex=0;if(typeof XMLHttpRequest!="undefined"){G=new XMLHttpRequest();}else{if(typeof ActiveXObject!="undefined"){G=new ActiveXObject("MSXML2.XMLHttp");}}G.open("get",this.url,true);G.onreadystatechange=function(){if(G.readyState==3){F._updateReadyState();try{F._processIncomingData(G.responseText);}catch(H){}}else{if(G.readyState==4){F._updateReadyState();F._validateResponse();}}};this._transport=G;setTimeout(function(){G.send(null);},0);},_validateResponse:function(){var F=this._transport;if(F.status>=200&&F.status<300){this._processIncomingData(F.responseText);if(this.readyState!=2){this._transport.onreadystatechange=function(){};this._init();}}else{this.fire("error");this.readyState=2;}F=null;},_updateReadyState:function(){if(this.readyState==0){this.readyState==1;}},_processIncomingData:function(L){L=L.substring(this._lastIndex);this._lastIndex+=L.length;var G=L.split("\n"),K,I=0,F=G.length,J="",H="";while(I<F){if(G[I].indexOf(":")>-1){K=G[I].split(":");switch(K.shift()){case"data":J+=K.join(":")+"\n";break;case"event":H=K[1];break;case"id":break;}}else{if(G[I].replace(/\s/g,"")==""){if(J!=""){if(J.charAt(J.length-1)=="\n"){J=J.substring(0,J.length-1);}this.fire({type:"message",data:J});J="";H="";}}}I++;}},close:function(){this.readyState=2;this._transport.abort();}};}E.extend(B,E.Event.Target,D);E.EventSource=B;},"@VERSION@",{requires:["event-base","event-custom"]});